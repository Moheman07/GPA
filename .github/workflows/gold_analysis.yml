name: Professional Gold Analysis Runner

on:
  # ูุณูุญ ุจุงูุชุดุบูู ุงููุฏูู ูู ุชุจููุจ Actions
  workflow_dispatch:
  
  schedule:
    # ูุนูู ูุฑุฉ ูุงุญุฏุฉ ูููููุง (ูู ุงูุฅุซููู ููุฌูุนุฉ) ุงูุณุงุนุฉ 21:00 ุจุชูููุช UTC
    # (ุฃู ุจุนุฏ ุณุงุนุฉ ูู ุฅุบูุงู ุณูู ูููููุฑู)
    - cron: '0 21 * * 1-5'

jobs:
  run-and-commit-analysis:
    runs-on: ubuntu-latest
    
    # ุฅุนุทุงุก ุตูุงุญูุฉ ูููุชุงุจุฉ ูู ุงููุณุชูุฏุน ูุญูุธ ุงููุชุงุฆุฌ
    permissions:
      contents: write
      
    # ุชูุฑูุฑ ููุชุงุญ ุงูุฃุฎุจุงุฑ ุงูุณุฑู ุฅูู ุงูุณูุฑุจุช
    env:
      NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}

    steps:
      # ุงูุฎุทูุฉ 1: ุณุญุจ ุงูููุฏ ูู ุงููุณุชูุฏุน
      - name: Checkout Repository
        uses: actions/checkout@v4

      # ุงูุฎุทูุฉ 2: ุฅุนุฏุงุฏ ุจูุฆุฉ ุจุงูุซูู ูุน ุงูุชุฎุฒูู ุงููุคูุช ููุณุฑุนุฉ
      - name: Set up Python with dependency caching
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip' # ุชูุนูู ุงูุชุฎุฒูู ุงููุคูุช

      # ุงูุฎุทูุฉ 3: ุชุซุจูุช ูู ุงูููุชุจุงุช ุงููุทููุจุฉ
      - name: Install dependencies
        run: pip install -r requirements.txt

      # ุงูุฎุทูุฉ 4: ุชุดุบูู ุณูุฑุจุช ุงูุชุญููู ุงูุฑุฆูุณู
      - name: Run Professional Gold Analyzer
        # ุชุฃูุฏ ูู ุฃู ุงุณู ูุฐุง ุงูููู ูุทุงุจู ุงุณู ุงูุณูุฑุจุช ูู ูุณุชูุฏุนู
        run: python main_analyzer.py

      # ุงูุฎุทูุฉ 5: ุญูุธ ูู ุงููููุงุช ุงููุงุชุฌุฉ ูู ุงููุณุชูุฏุน
      - name: Commit and Push Results
        # ูุฐู ุงูุฎุทูุฉ ุชุนูู ููุท ุฅุฐุง ูุฌุญุช ุงูุฎุทูุฉ ุงูุณุงุจูุฉ
        if: success()
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '๐ Update Professional Gold Analysis Report'
          # โ ูููู ุจุญูุธ ูู ุงููููุงุช ุงูุชู ููุชุฌูุง ุงูุณูุฑุจุช ุจุงูุฃุณูุงุก ุงูุตุญูุญุฉ
          file_pattern: 'gold_analysis_enhanced.json gold_analysis_history.db gold_analysis.log'
