name: Gold Analysis (daily)

on:
  schedule:
    # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø§Ù„Ø³Ø§Ø¹Ø© 02:00 ØµØ¨Ø§Ø­Ù‹Ø§ Ø¨ØªÙˆÙ‚ÙŠØª UTC (09:00 Ø¨Ù€ EST)
    - cron: '0 2 * * *'
  workflow_dispatch:            # Ù„ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© GitHub Ø¥Ø°Ø§ Ø±ØºØ¨Øª

jobs:
  run-analysis:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Ø§Ø­ÙØ¸ Ø§Ù„Ù€ commit Ø­ØªÙ‰ Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ø¥Ø°Ø§ Ø£Ø±Ø¯Ù†Ø§)
          persist-credentials: false

      # 2ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯ Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3ï¸âƒ£ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4ï¸âƒ£ ØªÙˆÙÙŠØ± Ù…ÙØªØ§Ø­ NewsAPI ÙƒØ³Ø±Ù‘ (ÙŠÙØ¹Ø±Ù‘Ù ÙÙŠ Settings > Secrets > Actions)
      - name: Run gold analysis script
        env:
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
        run: |
          python gold_trading.py

      # 5ï¸âƒ£ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒÙ€ Artifact (ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ù€ Action)
      - name: Upload JSON outputs as artifacts
        uses: actions/upload-artifact@v4
        with:
          name: gold-analysis-results
          path: |
            technical_analysis.json
            news_analysis.json
            combined_signal.json
            historical_signals.csv
          if-no-files-found: warn

      # 6ï¸âƒ£ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù†ÙØ³Ù‡
      #    (Ø³ÙŠØªØ³Ø¨Ø¨ Ù„Ø­Ø¯Ù‘ Ø£Ù‚ØµÙ‰ 20â€¯Ù…Ù„Ø§Ø­Ø¸Ø© Ù„ÙƒÙ„ ØªØ´ØºÙŠÙ„ â€“ ØªØ¬Ù†Ù‘Ø¨ Ø­Ù„Ù‚Ø§Øª ØºÙŠØ± Ù…Ø±ØºÙˆØ¨Ø©)
      - name: Commit & push updated results
        if: github.ref == 'refs/heads/main'   # Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø°ÙŠ ØªØ¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          git add technical_analysis.json news_analysis.json combined_signal.json historical_signals.csv
          git commit -m "ğŸ“ˆ ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°Ù‡Ø¨ (autoâ€‘commit) [skip ci]"
          git push
